## 1.1 엘라스틱서치의 탄생

엘라스틱서치가 등장할 시기에는 사이트 내에서 전문 검색 기능(Fullscan)이 요구되었다. 인터넷 검색 서비스는 계속해서 등장하고 있었지만 구현체를 공개하지 않아 일반 개발자는 검색 이면에 숨은 비밀에 접근하기 어려웠다. 따라서 기업이 제공하는 솔루션에 의존할 수밖에 없어서 검색 기능의 발전에 큰 걸림돌이 되었다.

1999년 더그 커딩이 만든 검색 엔진 라이브러리 루씬은 2001년도에 아파치 자카르타에 합류하고 규모가 점점 확장되어 2005년에 본격적인 아파치 프로젝트로 분리된다. 루씬은 전문 인덱싱과 검색 기능을 요구하는 애플리케이션에 사용되기 시작했다. 
하지만 루씬은 라이브러리 형태로 되어 있어 제대로 사용하기 위해 해야 할 작업이 무척 많았다. 이때 기술 잡지를 만들던 CNET 네트워크에서 2004년경 사내 웹사이트 검색을 위해 직접 제작한 검색 엔진의 소스 코드인 솔라 프로젝트를 2006년에 아파치 재단에 기부하였다. 솔라는 상용 서비스에 적합한 수준의 높은 트래픽을 뒷받침하는 고성능의 검색 엔진으로 많은 사람들의 관심을 끌었고, 2010년 3월 루씬과 통합되어 함께 개발을 진행하게 된다. 2021년 2월 루씬에서 분리되어 독립된 아파치 최상위 프로젝트로 자리 잡았다.

CNET 네트워크가 솔라를 개발하고 있었을 2004년 무렵 자신의 부인이 손쉽게 레시피를 검색할 수 있도록 루씬을 기반으로 캄파스 프로젝트를 진행하던 사이 배넌은 확장 가능한 검색 엔진 솔루션을 만들면 좋겠다는 생각을 하게 된다. 처음부터 분산 환경을 위한 솔루션, HTTP 상에서 JSON으로 인터페이스를 지원하는 솔루션, 자바 이외에도 다양한 프로그래밍 언어를 지원하는 솔루션을 표방하고 작업에 들어간 배넌은 2010년 2월에 드디어 엘라스틱서치를 공개한다.

## 1.2 엘라스틱 스택으로 발전

엘라스틱은 단순 검색 엔진에 머무르는 대신 플랫폼으로 발전하는 길을 선택했다. 데이터가 점점 늘어나는 상황에서 전문 검색은 대량의 데이터를 저장해서 처리하는 한 가지 방법에 불과했고, 다양한 사용 사례를 유연하게 지원하기 위해서는 검색 엔진을 뛰어넘는 플랫폼이 필요해졌다. 하지만 유연성을 확보하려면 데이터를 수집, 가공, 저장, 분석, 시각화하는 일련의 파이프라인을 구성하기 위해 다양한 오픈소스 소프트웨어를 조합해야 하는 불편함이 있었다. 엘라스틱은 바로 이 지점에서 사용자의 요구사항을 충족하기 위해 스택을 쌓아 올리기 시작했다.

엘라스틱서치가 개발될 무렵 요르단 시셀은 사용자가 선택한 보관함으로 로그를 보내는 오픈소스 데이터 수집 도구인 로그스태시를 개발하고 있었고, 라시드 칸은 오픈소스 시각화 UI인 키바나를 개발하고 있었다. 사이 배넌은 두 사람과 함께 팀을 결성하여 엘라스틱서치, 로그스태시, 키바나를 합친 엘라스틱 스택을 개발했다.

초창기에는 스택이 느슨한 형태로 개발되어 각자 원하는 버전이 제각각 출시하는 형태였으나 사용자 요구에 맞춰 버전을 동일하게 맞춘 제춤을 동시에 출시하기 시작했다. 2015년 베를린의 패킷비트라는 회사가 기존에 개발하고 있던 프로젝트와 협력하여 엣지 장비에서 로그스태시와 엘라스틱서치로 네트워크 데이터, 로그, 메트릭, 성능 진단 데이터를 보내는 경량 데이터 수집기 비츠를 제작한다.

## 1.3 엘라스틱 스택의 구성요소

엘라스틱 스택은 일반적인 빅데이터 파이프라인을 구성하기 위한 데이터 수집, 가공, 저장, 분석, 시각화에 필요한 모든 소프트웨어를 갖추고 있다. 비츠와 로그스태시는 데이터를 수집하고 가공하는 역할, 엘라스틱서치는 저장하고 분석하는 역할, 키바나는 엘라스틱서치에 저장된 데이터를 시각화하고 모니터링하는 역할을 수행한다.

### 1.3.1 엘라스틱서치: 분산 검색 엔진

- 엘라스틱서치는 검색 엔진이지만 구글이나 네이버 같은 포탈 서비스와는 또 다르다. 
- 엘라스틱서치는 모든 레코드를 JSON 도큐먼트 형태로 입력하고 관리한다. 
- 일반적인 데이터베이스와 마찬가지로 쿼리한 결과에 대해 일치하는 원본 도큐먼트를 반환한다.
- 또한 텍스트 외에도 숫자, 날짜, IP 주소, 지리 정보등 다양한 데이터 타입에 최적화되어 있다. 
- 검색 엔진이면서 데이터베이스이기도 하고 텍스트 외에 다양한 데이터 타입을 지원하는 일종의 NoSQL 데이터베이스

#### 구조

- 텍스트나 도큐먼트의 경우 인덱싱 시점에 분석을 거쳐 용어 단위로 분해하여 역인데스 사전을 구축
- 숫자나 키워드 타입의 데이터들은 집계에 최적화된 컬럼 기반 자료구조로 저장
- 병렬 처리나 분산 처리를 할 수 있다.
- 검색 엔진인 동시에 데이터베이스이기 때문에 RDBMS나 다른 NoSQL 제품보다 빠른 검색과 집계가 가능
- 충분한 크기의 클러스터가 구성되어 있다면 데이터 양과 무관하게 1초 이내의 응답 속도를 기대할 수 있다.

#### 장점

- 검색 엔진으로 중요한 특징 중 하나로 스코어링, 검색어에 대한 유사도 스코어를 기반으로 한 정렬을 제공
- 특히 복잡한 문자열 콘텐츠에서 검색을 수행할 때 큰 효과를 보인다. 
- 모든 통신을 REST API를 이용하도록 만들어 프로그래밍 언어와 무관하게 사용자가 쉽게 접근할 수 있다.

#### 단점

- 저장공간이 크게 압축되지 않고 시스템 리소스를 많이 사용한다.
- DSL 쿼리를 채용하는데 JOIN 쿼리가 사실상 어렵기 때문에 반정규화를 기본으로 모델링해야 한다.
- 인덱스가 불변의 자료구조이기 때문에 도큐먼트를 수정/삭제하는 비용이 크다.

### 1.3.2 키바나: 시각화와 엘라스틱서치 관리 도구

- 엘라스틱서치는 REST API가 잘 설계된 제품이긴 하지만 복잡한 요청을 일일이 작성하기에는 다소 불편할 수 있다. 
- 키바나는 이런 불편함을 해소하기 위해 엘라스틱서치에 대한 UI를 제공
- 키바나는 엘라스틱서치에 대한 대부분의 관리 기능, API 실행 콘솔, 솔루션 페이지, 각 스택의 모니터링 페이지를 다양한 차트 및 테이블로 쉽게 구성할 수 있다.

### 1.3.3 로그스태시: 이벤트 수집과 정제를 위한 도구

- 대량의 데이터를 검색하기 위해 가장 먼저 선행돼야 할 작업은 데이터를 적재하는 것
- 데이터 적재는 데이터를 다룰 때 가장 손이 많이 가는 작업이며 꾸준한 모니터링과 개선이 필요한 부분
- 로그스태시는 로그, 메트릭, 웹 애플리케이션 등 다양한 소스로부터 로그를 수집할 수 있게 도와준다.
- 필터 기능이 있어 비정형이나 반정형 데이터를 분석하기 쉬운 형태로 정제할 수 있다.
- 엘라스틱 서치 외에도 다양한 플랫폼으로 정제된 데이터를 보낼 수 있다.

#### 장점

- 확장 가능한 200개 이상의 플러그인 덕분에 별도의 코딩 없이 간단한 설정만으로 로그를 가공할 수 있다.
- 엘라스틱서치의 인덱싱 성능 최적화를 위한 배치 처리와 병렬 처리가 장점
- 영속적인 큐를 사용해 현재 처리 중인 이벤트의 최소 1회 전송을 보장
- 유동적인 처리 방식으로 수집 중인 데이터양이 급증하는 부하 상황에서도 안정성을 보장


### 1.3.4 비츠: 엣지단에서 동작하는 경량 수집 도구

- 이벤트 정보를 수집하려면 서비스가 동작하는 호스트에 설치가 필요한데, 로그스태시는 다양한 필터와 설정을 지원하는 만큼 무거움
- 이를 위해 다양한 용도별로 최적화된 비트를 일컫는 경량 수집기 비츠를 사용
- 각 비트는 로그 수집, 시스템 지표 등 특정 목적에 최적화된 에이전트이며 가볍기로 유명한 고 언어로 작성되었다.
- 또한 로그스태시 수준의 복잡한 이벤트 가공은 지원하지 않아 가벼우므로 각 서비스 호스트에 비교적 부담 없이 설치할 수 있다.

#### 사용 예

- 이러한 양쪽의 장점을 활용하기 위해 보통 비츠와 로그스태시를 혼합하여 사용
- 비츠에서 각 서비스 호스트의 정보를 수집하고 로그스태시에서 이를 취합하고 가공해 엘라스틱서치로 전송하는 형태로 사용


## 1.4 엘라스틱 스택의 용도

1. 전문 검색 엔진
	- 가장 기본적인 용도
	- 전문은 단순한 문장부터 뉴스 기사나 논문 등 다양한 글의 전체 내용을 의미
	- 전문을 용어단위로 분석해 인덱싱해두고 이를 기반으로 검색을 수행하는 역인덱싱 기법을 많이 사용
2. 로그 통합 분석
	- 여러 장비와 서비스에서 발생하는 로그들을 통합하고 검색하는데 최적화된 솔루션
	- 엘라스틱서치에 저장된 데이터들은 교차 분석이나 연관 분석이 쉽다.
	- 인덱스 패턴을 사용하여 한 번에 여러 인덱스를 동시에 조회할 수 있다. 
	- 복잡한 JOIN 쿼리 없이도 각기 다른 서비스에서 동시간대에 발생한 로그를 쉽게 찾을 수 있다.
3. 보안 이벤트 분석
	- 다양한 장비들로부터 보안 이벤트를 수집하고 분석
4. 애플리케이션 성능 분석
	- 애플리케이션의 상태를 지속적으로 모니터링
	- 엘라스틱 스택의 애플리케이션 성능 모니터링 도구 APM
5. 머신러닝
	- 엘라스틱 스택에서 유료 라이선스 구매시 사용할 수 있는 강력한 기능
	- 데이터를 엘라스틱서치에 넣은 다음 머신러닝 기법을 활용해 패턴을 발견

## 1.5 빅데이터 플랫폼의 일부로 동작하는 엘라스틱 스택

- 엘라스틱 스택은 간편하게 빅데이터 파이프라인을 구성하고 싶은 기업의 요구사항을 충족
- 우버의 경우 대규모 실시간 데이터 통찰 플랫폼인 가이로스를 구축
	- 아파치 카프카 토픽으로부터 가이로스 수집 파이프라인을 거쳐 분석 대상 데이터 저장
	- 고객 질의가 가이로스 질의 서비스를 거쳐 엘라스틱 검색/집계 쿼리를 활용
	- 장기 분석을 위해 엘라스틱서치에 저장된 분석 데이터를 HDFS에 누적
	- 하이브와 프레스토를 사용해 통찰 제공
